<!DOCTYPE HTML>
<html lang="en">
<head>
	<title>The QT Admin</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	
<style type="text/css">
	@import url(http://reset5.googlecode.com/hg/reset.min.css);
	 
	body{
		color: #242323;
	}
	a{color: #242323;}
		a:hover{}
	ul{list-style-type: none;}
	
	#container{
		padding: 20px;
	}
	
	header{
		margin-bottom: 30px;
		font-size: 1.2em;
	}
	
	form{
		float: left;
		width: 800px;
		padding: 20px;u
	}

	section{
		overflow: hidden;
		border-bottom: 3px solid #555;
	}
	
	input, textarea{
		display: block;
		margin-bottom: 20px;
		padding: 5px;
	}
</style>

<script type="text/javascript">	
	// INIT
	$(document).ready(function(){
		// fetch url form
		$("form#fetch-url input[type='submit']").click(function(event){
			console.log("fetching "+$("form input[type='url']").val()+"...");
			fetchQuotesome($("form input[type='url']").val());
		});
		
		// update db form
		$("form#update-db").submit(function(event){
			console.log("posting DB update...");
			var data = {
				author:		$('#author').val(),
				authorID:	$('#author-id').val(),
				quoteUrl:	$('#quote-url').val(),
				quoteText:	$('#quote-text').val(),
				pubDate:	$('#pubdate').val(),
			};
			
			$.ajax({
			  type: "POST",
			  url: '/admin-add-quote',
			  data: JSON.stringify(data)
			});
		});
		
		// fetch schedule form
		$("form#fetch-schedule").submit(function(event){
			console.log("fetching schedule...");
			
			$.ajax({
			  type: "POST",
			  url: '/admin-fetch-schedule'
			});
		});
	});
	
	function fetchQuotesome(url){
		var ExternalURL = url; // This address must not contain any leading 'http://'

		var QueryURL = "http://anyorigin.com/get?url=" + ExternalURL + "&callback=?";
		$.getJSON(QueryURL, function(data){
			if (data && data != null && typeof data == 'object' && data.contents && data.contents != null && typeof data.contents == 'string'){
				data = data.contents.replace(/<script[^>]*>[sS]*?<\/script>/gi, '');
				if (data.length > 0){
					$('#author').val($('.row .author', data).html());
					$('#author-id').val((($('.author', data).html()).toLowerCase()).replace(/ /g,'_'));
					$('#quote-url').val(url);
					$('#quote-text').val($('.quote-block-quote-text', data).html());
					var now = new Date();
					$('#pubdate').val(now.getFullYear()+'-'+(now.getMonth()<9 ? '0'+(now.getMonth()+1) : now.getMonth()+1)+'-'+(now.getDate()<10 ? '0'+now.getDate() : now.getDate()));
				}
			}
		});
	}
	

</script>

</head>

<body>
	<div id="container">
		<header>
			<h1>QUOTES ADMIN (go to <a href="">authors admin</a>)</h1>
		</header>
		
		<section id="input">
			<form id="fetch-url" onsubmit="return false;">
				<input type="url" name="source-url" placeholder="fetch from url" size="100" autofocus required value="http://quoteso.me/q/226937" />
				
				<input type="submit" value="fetch url" />
			</form>
		
			<form id="update-db" onsubmit="return false;">
				<input id="author" name="author" type="text" size="60" placeholder="author" />
				<input id="author-id" name="author-id" type="text" size="60" placeholder="authorID" />
				<input id="quote-url" name="quote-url" type="url" size="60" placeholder="quote url" />
				<textarea id="quote-text" name="quote-text" rows="5" cols="60" placeholder="quote text"></textarea>
				<input id="pubdate" name="pubdate" type="date"/>
				
				<input type="submit" value="update db" />
			</form>
		</section>
		
		<section id="output">
			<form id="fetch-schedule" onsubmit="return false;">
				<input type="submit" value="fetch schedule" />
			</form>
		
		</section>
		
		<footer>
		</footer>
	</div>
</body>

</html>
